---
title: "Build and Deploy a Stroke Prediction Model using R"
author: "Adnan Ayub"
date: "`r Sys.Date()`"
output: html_document
---

# About Data Analysis Report
This RMarkdown file contains the report of the data analysis done for the project on building and deploying a stroke prediction model in R.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(caret)
library(randomForest)
library(e1071)
library(xgboost)
```

# Task One: Import and Preprocess Data
```{r}
data <- read_csv("healthcare-dataset-stroke-data.csv")
data <- data %>% select(-id)
data$bmi <- as.numeric(data$bmi)
data$bmi[is.na(data$bmi)] <- mean(data$bmi, na.rm = TRUE)
data <- data %>% mutate(across(c(gender, ever_married, work_type, Residence_type, smoking_status, stroke), as.factor))
summary(data)
```

# Task Two: Build Prediction Models
```{r}
set.seed(123)
train_index <- createDataPartition(data$stroke, p = 0.8, list = FALSE)
train_data <- data[train_index, ]
test_data  <- data[-train_index, ]

rf_model <- randomForest(stroke ~ ., data = train_data, ntree = 200)
rf_pred <- predict(rf_model, test_data)

log_model <- glm(stroke ~ ., data = train_data, family = binomial)
log_pred <- predict(log_model, test_data, type = "response")
log_pred_class <- ifelse(log_pred > 0.5, 1, 0)

x_train <- model.matrix(stroke ~ . -1, data = train_data)
y_train <- as.numeric(train_data$stroke) - 1
x_test  <- model.matrix(stroke ~ . -1, data = test_data)
y_test  <- as.numeric(test_data$stroke) - 1
xgb_model <- xgboost(data = x_train, label = y_train, nrounds = 100, objective = "binary:logistic")
xgb_pred <- predict(xgb_model, x_test)
xgb_pred_class <- ifelse(xgb_pred > 0.5, 1, 0)
```

# Task Three: Evaluate Models
```{r}
rf_cm <- confusionMatrix(rf_pred, test_data$stroke)
log_cm <- confusionMatrix(as.factor(log_pred_class), test_data$stroke)
xgb_cm <- confusionMatrix(as.factor(xgb_pred_class), test_data$stroke)
rf_cm
log_cm
xgb_cm
```

# Task Four: Deploy the Best Model
```{r}
saveRDS(rf_model, "final_stroke_rf_model.rds")
cat("Random Forest model saved as final_stroke_rf_model.rds")
```

# Task Five: Findings and Conclusions
- Data cleaned and missing BMI handled.
- Built three models: Logistic Regression, Random Forest, and XGBoost.
- Random Forest chosen as the best model.
- Model ready for deployment for new patient prediction.
